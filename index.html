<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Painel de Preventivas ‚Äî Admin</title>
  <style>
    :root{
      --bg1:#0ea5e9; --bg2:#38bdf8; --text:#0f172a; --card:#ffffff;
      --muted:#64748b; --border:#e2e8f0; --ok:#16a34a; --err:#ef4444; --warn:#f59e0b;
      --primary:#2563eb;
    }
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .container{
      width:100%;
      max-width:1100px;
      background:rgba(255,255,255,0.98);
      border-radius:18px;
      padding:20px;
      box-shadow:0 20px 40px rgba(15,23,42,0.25);
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    header{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
      padding-bottom:8px;
    }
    header h1{
      font-size:1.4rem;
      font-weight:700;
      letter-spacing:0.02em;
    }
    header span.badge{
      font-size:0.8rem;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(37,99,235,0.08);
      color:var(--primary);
      font-weight:600;
    }

    /* LOGIN */
    #login-screen{
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px 0;
    }
    .login-card{
      width:100%;
      max-width:360px;
      padding:20px 18px;
      border-radius:16px;
      border:1px solid var(--border);
      background:linear-gradient(145deg,#ffffff,#f8fafc);
      box-shadow:0 10px 25px rgba(15,23,42,0.10);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .login-card h2{
      font-size:1.2rem;
      margin-bottom:4px;
    }
    .login-card p{
      font-size:0.85rem;
      color:var(--muted);
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-top:6px;
    }
    .field label{
      font-size:0.8rem;
      color:var(--muted);
    }
    .field input{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:0.9rem;
      outline:none;
    }
    .field input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,0.20);
    }
    .btn{
      margin-top:10px;
      width:100%;
      padding:9px 10px;
      border-radius:999px;
      border:none;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      background:linear-gradient(135deg,#2563eb,#1d4ed8);
      color:#ffffff;
    }
    .btn:disabled{
      opacity:0.6;
      cursor:wait;
    }
    .login-error{
      margin-top:6px;
      font-size:0.8rem;
      color:var(--err);
    }

    /* APP ADMIN */
    #app-admin{
      display:none; /* escondido at√© logar */
      flex-direction:column;
      gap:14px;
    }

    .topbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .user-info{
      font-size:0.8rem;
      color:var(--muted);
    }
    .user-info strong{
      color:var(--text);
    }
    .btn-logout{
      padding:6px 12px;
      border-radius:999px;
      border:none;
      font-size:0.8rem;
      font-weight:600;
      cursor:pointer;
      background:#fee2e2;
      color:#b91c1c;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:12px;
      margin-top:4px;
    }
    .card{
      border-radius:14px;
      border:1px solid var(--border);
      background:#ffffff;
      padding:12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .card h3{
      font-size:0.95rem;
      margin-bottom:2px;
    }
    .card span.label{
      font-size:0.75rem;
      color:var(--muted);
    }

    @media (max-width:600px){
      .container{
        padding:16px 12px;
      }
      header h1{
        font-size:1.1rem;
      }
    }
  </style>
</head>
<body>
  <main class="container">
    <header>
      <div>
        <h1>Painel de Preventivas ‚Äî Admin</h1>
        <span class="badge">Acesso restrito</span>
      </div>
    </header>

    <!-- TELA DE LOGIN -->
    <section id="login-screen">
      <div class="login-card">
        <h2>Login administrativo</h2>
        <p>Somente usu√°rios autorizados podem acessar o painel de preventivas.</p>

        <div class="field">
          <label for="email">E-mail</label>
          <input type="email" id="email" autocomplete="email" placeholder="seu.email@empresa.com">
        </div>

        <div class="field">
          <label for="senha">Senha</label>
          <input type="password" id="senha" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>

        <button class="btn" id="btnLogin">Entrar</button>
        <div class="login-error" id="loginError"></div>

        <p style="font-size:0.75rem;margin-top:6px;">
          Cadastre os usu√°rios no Firebase Authentication (E-mail/Senha) e limite aqui por e-mail.
        </p>
      </div>
    </section>

    <!-- APP ADMIN (MOSTRADO AP√ìS LOGIN) -->
    <section id="app-admin">
      <div class="topbar">
        <div class="user-info">
          Logado como: <strong id="userEmail"></strong><br>
          <span>Permiss√£o: administrador de preventivas</span>
        </div>
        <button class="btn-logout" id="btnLogout">Sair</button>
      </div>

      <!-- AQUI DENTRO VAI O SEU PAINEL ADMIN ORIGINAL -->
      <div id="conteudo-admin-real">
        <div class="grid">
          <div class="card">
            <h3>Resumo (exemplo)</h3>
            <span class="label">Substitua estes cards pelo conte√∫do real do painel admin.</span>
            <p style="font-size:0.85rem;margin-top:4px;">
              Aqui voc√™ pode colar tabelas, cards, listas de preventivas, filtros, etc.
            </p>
          </div>

          <div class="card">
            <h3>Pr√≥ximas preventivas (exemplo)</h3>
            <span class="label">somente admin visualiza</span>
            <ul style="margin-left:16px;font-size:0.85rem;margin-top:4px;">
              <li>M√°quina X ‚Äì 20/11</li>
              <li>M√°quina Y ‚Äì 25/11</li>
            </ul>
          </div>

          <div class="card">
            <h3>Configura√ß√µes (exemplo)</h3>
            <span class="label">gest√£o de cadastros, setores, etc.</span>
          </div>
        </div>
      </div>
      <!-- FIM CONTE√öDO ADMIN -->
    </section>
  </main>

  <!-- FIREBASE AUTH -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

    // üî¥ IMPORTANTE:
    // COLE AQUI O MESMO firebaseConfig OFICIAL DO APP DE PREVENTIVAS DA GRILAZER
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      // se voc√™ usa databaseURL, storageBucket, messagingSenderId, appId, measurementId,
      // pode deixar tudo igual ao arquivo oficial do app Preventivas.
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // LISTA DE E-MAILS AUTORIZADOS A ENTRAR NO ADMIN
    const allowedEmails = [
      "seu.email@empresa.com",   // voc√™
      // "outro.usuario@empresa.com", // se quiser liberar para mais algu√©m
    ];

    const loginScreen = document.getElementById("login-screen");
    const appAdmin = document.getElementById("app-admin");
    const userEmailSpan = document.getElementById("userEmail");
    const btnLogin = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");
    const loginError = document.getElementById("loginError");
    const emailInput = document.getElementById("email");
    const senhaInput = document.getElementById("senha");

    function setLoading(isLoading){
      btnLogin.disabled = isLoading;
      btnLogin.textContent = isLoading ? "Entrando..." : "Entrar";
    }

    function showLogin(){
      loginScreen.style.display = "flex";
      appAdmin.style.display = "none";
      loginError.textContent = "";
      senhaInput.value = "";
    }

    function showApp(user){
      loginScreen.style.display = "none";
      appAdmin.style.display = "flex";
      userEmailSpan.textContent = user.email;
    }

    // Estado de autentica√ß√£o
    onAuthStateChanged(auth, (user) => {
      if(user && allowedEmails.includes(user.email)){
        showApp(user);
      } else {
        if(user && !allowedEmails.includes(user.email)){
          // logou mas n√£o est√° na whitelist -> derruba
          signOut(auth);
        }
        showLogin();
      }
    });

    // Login
    btnLogin.addEventListener("click", async () => {
      loginError.textContent = "";
      const email = emailInput.value.trim();
      const senha = senhaInput.value;

      if(!email || !senha){
        loginError.textContent = "Preencha e-mail e senha.";
        return;
      }

      try{
        setLoading(true);
        const cred = await signInWithEmailAndPassword(auth, email, senha);
        const user = cred.user;

        if(!allowedEmails.includes(user.email)){
          await signOut(auth);
          loginError.textContent = "Seu usu√°rio n√£o tem permiss√£o para acessar este painel.";
          return;
        }
        // onAuthStateChanged vai chamar showApp(user)
      }catch(err){
        console.error(err);
        loginError.textContent = "Login inv√°lido. Verifique e-mail e senha.";
      }finally{
        setLoading(false);
      }
    });

    // Logout
    btnLogout.addEventListener("click", async () => {
      await signOut(auth);
      showLogin();
    });
  </script>
</body>
</html>
